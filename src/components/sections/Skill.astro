---
import SkillCard from "../elements/SkillsCard.astro";

const CERTIFICATE_PATH = "/portfolio/skills";

const CERTIFICATES = [
  {
    title: "XVIII ANFECA Regional Marathon",
    description:
      "Obtained 1st place in the XVIII ANFECA Regional Marathon held in 2025, demonstrating knowledge in informatics and teamwork.",
    pdfUrl: `${CERTIFICATE_PATH}/ANFECA_Certificate.jpg`,
  },
  {
    title: "Specialization in English ",
    description:
      "Completed a specialization course in English at The Institute the ultimate language school at Coatzacoalcos, Ver.",
    pdfUrl: `${CERTIFICATE_PATH}/sepToelf.pdf`,
  },
  {
    title: "EXAVER 2",
    description:
      "Achieved EXAVER 2 certification from the Universidad Veracruzana, showcasing advanced English language skills.",
    pdfUrl: `${CERTIFICATE_PATH}/exaver.pdf`,
  },
  {
    title: 'Latest "Nota Laudatoria" ',
    description:
      "Earned it for outstanding academic performance during the semester in Software Engineering at Universidad Veracruzana.",
    pdfUrl: `${CERTIFICATE_PATH}/notaLaudatoria.pdf`,
  },
  {
    title: "TICS job training",
    description:
      "For completing the TICS job training program, focusing on enhancing technical skills at the Colegio Anglo Mexicano de Coatzacoalcos.",
    pdfUrl: `${CERTIFICATE_PATH}/anglo.pdf`,
  },
];
---

<section id="skills" class="max-w-4xl mx-auto px-4 sm:px-6 py-12 sm:py-20">
  <div class="border-t-2 border-b-accent-200 pt-8 pb-4">
    <h2 class="text-2xl sm:text-4xl font-bold text-red-500 mb-8 text-center">
      Skills & Certifications
    </h2>
    <p class="p-2 text-zinc-400 leading-relaxed max-w-2xl mx-auto mb-8 text-center">
      Here are some of my skills and certifications that demonstrate my
      commitment to continuous learning and professional development.
    </p>
    <div class="skills-gallery">
      {
        CERTIFICATES.map((cert) => (
          <SkillCard
            title={cert.title}
            description={cert.description}
            pdfUrl={cert.pdfUrl}
            thumbnail="document.png"
          />
        ))
      }

      <script>
        const modal = document.getElementById("pdfModal") as HTMLDialogElement;
        const viewer = document.getElementById("pdfFrame") as HTMLIFrameElement;
        const closeBtn = document.getElementById(
          "closePdfModal",
        ) as HTMLButtonElement;

        document.querySelectorAll(".pdf-preview").forEach((card) => {
          card.addEventListener("click", () => {
            const skill = card.getAttribute("data-pdf");
            if (skill && viewer && modal) {
              if (window.innerWidth < 600) {
                window.open(skill, "_blank");
              } else {
                viewer.src = skill;
                modal.showModal();
                document.body.classList.add("no-scroll");
              }
            }
          });
        });

        closeBtn?.addEventListener("click", (e) => {
          modal.close();
          viewer.src = "";
          document.body.classList.remove("no-scroll");
        });

        modal?.addEventListener("click", (e) => {
          const dialogDimensions = modal.getBoundingClientRect();
          if (
            e.clientX < dialogDimensions.left ||
            e.clientX > dialogDimensions.right ||
            e.clientY < dialogDimensions.top ||
            e.clientY > dialogDimensions.bottom
          ) {
            modal.close();
            viewer.src = "";
            document.body.classList.remove("no-scroll");
          }
        });

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("active");
                observer.unobserve(entry.target);
              }
            });
          },
          {
            threshold: 0.1,
          },
        );

        document.querySelectorAll(".skill-card").forEach((section) => {
          observer.observe(section);
        });
      </script>

      <dialog id="pdfModal" class="pdf-modal">
        <div class="pdf-content">
          <div class="header">
            <button class="close-x" id="closePdfModal">&times;</button>
          </div>

          <div class="iframe-container">
            <iframe id="pdfFrame" src="" title="Document Preview"></iframe>
          </div>
        </div>
      </dialog>

      <style>
        :global(body.no-scroll) {
          overflow: hidden !important;
        }

        .pdf-modal {
          border: none;
          border-radius: 12px;
          width: 85vw;
          max-width: 900px;
          height: 85vh;
          background: var(--color-card-bg);
          color: #fff;
          padding: 0;
          margin: auto;
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
          overflow: hidden;
        }

        .pdf-modal::backdrop {
          background-color: rgba(0, 0, 0, 0.7);
          backdrop-filter: blur(2px);
        }

        .pdf-content {
          display: flex;
          flex-direction: column;
          height: 100%;
          position: relative;
          width: 100%;
          padding: 40px 60px 20px 60px;
        }

        .close-x {
          position: absolute;
          top: 20px;
          right: 25px;
          background: none;
          border: none;
          color: #666;
          font-size: 2rem;
          cursor: pointer;
          transition: color 0.2s;
        }

        .close-x:hover {
          color: #fff;
        }

        .iframe-container {
          flex-grow: 1;
          min-width: fit-content;
          min-height: fit-content;
          border-radius: 4px;
          overflow: hidden;
          background: #252525;
        }

        #pdfFrame {
          width: 100%;
          height: 100%;
          border: none;
        }
      </style>
    </div>
  </div>
</section>
